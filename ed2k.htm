<HTML>
<HEAD>
<TITLE>eMule & eDonkey Link to Discuz! 3.1.2 URL - Converter</TITLE>
<META http-equiv=Content-Type content="text/html; charset=gb2312">
<META content=Tele name=Author>
<STYLE>
TEXTAREA {BORDER-RIGHT: black 1px solid; BORDER-TOP: black 1px solid; FONT-SIZE: 11px; BORDER-LEFT: black 1px solid; WIDTH: 700px; BORDER-BOTTOM: black 1px solid; FONT-FAMILY: "Courier New,宋体,SimSun"; BACKGROUND-COLOR: #fafad2}
BODY,td {FONT: 12px Tahoma,宋体,SimSun}
.Title {FONT: bold 15px Tahoma,宋体,SimSun}
INPUT {BORDER-RIGHT: black 1px solid; BORDER-TOP: black 1px solid; BORDER-LEFT: black 1px solid; BORDER-BOTTOM: black 1px solid; BACKGROUND-COLOR: #ffdead}
select {BORDER: black 1px solid; font-family: Tahoma; font-size: 8pt}
</STYLE>
<SCRIPT language=JavaScript>
<!--

function ConvUnicodeEd2k(ed2klink) {
	return unescape(decodeURIComponent(escape(ed2klink)));
}

function ConvUnicodeEd2kWOEsc(ed2klnk) {
	return unescape(decodeURIComponent(ed2klnk));
}

function Convert() {
  var originStr = document.forms[0].Hrefs.value;
  var objectStr="", subStr;
  originStr = originStr.replace(/\.\[VeryCD\.com\]/g, "");
  originStr = originStr.replace(/\[/g, "%5B");
  originStr = originStr.replace(/\]/g, "%5D");
  LineEnd = originStr.indexOf("\n")
  while(LineEnd > 0) {
    subStr = originStr.substring(0,LineEnd);
    if (!(document.forms[0].CheckBox2.checked && subStr.length<3))
      objectStr = objectStr + Href2VBBUrl(subStr) + "\n";
    originStr = originStr.substring(LineEnd+1,originStr.length);
    LineEnd = originStr.indexOf("\n");
  }
  objectStr = objectStr + Href2VBBUrl(originStr);

  document.forms[0].VBBURLs.value = objectStr;
  //alert(objectStr);
}

function round_dp(num , dp) {
  var sh = Math.pow(10 , dp)
  return Math.round(num * sh) / sh
}


function Href2VBBUrl(origin) {
  var rtnStr = "";

  if(origin.length >6) {
    var HrefStart = origin.indexOf("ed2k://");
    var HrefEnd = 0 ;
    var i = 0;
    var temp = "";
    var temp2 = "";

    var HrefEnd = origin.lastIndexOf("\|\/")+2;

    if(HrefEnd == 1) {
       HrefEnd=0;
       while(i<5){
	  HrefEnd = origin.indexOf("\|",HrefEnd+1);
	  i++;
       }
       i=0;
       HrefEnd++;
    }

    var Href = origin.substring(HrefStart,HrefEnd);
    if (document.forms[0].CheckBox3.checked) {
    	Href=ConvUnicodeEd2kWOEsc(Href);
    	return(Href);
    }

    while(i<HrefEnd){
			temp2=(Href.charAt(i)).replace(" ","\.");
    	temp2=temp2.replace("'","`");
			temp=temp.concat(temp2);
			i++;
    }
    Href = temp;
    TextStart = HrefStart +13;
	//origin.indexOf("le|")+3;

    var TextEnd;
    TextEnd = 0;
    i = 0;
    while(i<3){
	TextEnd = origin.indexOf("\|",TextEnd+1);
	i++;
    }

    var HrefText = origin.substring(TextStart,TextEnd);
    HrefText = ConvUnicodeEd2kWOEsc(HrefText);

    var SizeStart=TextEnd+1;
    var SizeEnd=0;
    i=0;
    while(i<4){
	SizeEnd = origin.indexOf("\|",SizeEnd+1);
	i++;
    }
    var SizeText = origin.substring(SizeStart,SizeEnd);

    if(SizeText < 1024) {
      var byte="B";
    }
    else if(SizeText < 10240) {
      SizeText=round_dp(SizeText/1024, 2);
      var byte="K";
    }
    else if(SizeText < 102400) {
      SizeText=round_dp(SizeText/1024, 1);
      var byte="K";
    }
    else if(SizeText < 1048576) {
      SizeText=Math.round(SizeText/1024);
      var byte="K";
    }
    else if (SizeText < 10485760) {
      SizeText=round_dp(SizeText/1048576,2);
      var byte="M";
    }
    else if (SizeText < 104857600) {
      SizeText=round_dp(SizeText/1048576,1);
      var byte="M";
    }
    else if (SizeText < 1073741824) {
      SizeText=Math.round(SizeText/1048576);
      var byte="M";
    }
    else {
      SizeText=round_dp(SizeText/1073741824, 2);
      var byte="G";
    }
    rtnStr = "点击下载: " + "[URL=" + Href + "]";
    if (document.forms[0].CheckBox1.checked)
    	rtnStr += "[color=" + document.forms[0].color.value + "]" + HrefText + "[/color]";
    else
      rtnStr += HrefText;
    rtnStr += "[/URL]" + "　大小: " + SizeText + byte;
  }
  return rtnStr;
}

function ClipBoard() {
  var tempval=eval("document.forms[0].VBBURLs")
  tempval.focus()
  tempval.select()
  therange=tempval.createTextRange()
  therange.execCommand("Copy")
}

function ClipBoardpaste() {
  var tempval=eval("document.forms[0].Hrefs")
  tempval.focus()
  tempval.select()
  therange=tempval.createTextRange()
  therange.execCommand("Paste")
}

//-->
</SCRIPT>
</HEAD>

<BODY><center>
<p class=Title>eMule 及 eDonkey 链接至 Discuz! URL 代码转换程序</p>
<table border=0><FORM><tr><td>
<div>EDonkey 及 eMule 链接：
　<INPUT onclick=ClipBoardpaste(); type=button value="从剪贴板粘贴">
　<INPUT onclick=Convert(); type=button value="转换">
　<INPUT onclick=ClipBoard(); type=button value="复制到剪贴板">
　<INPUT type=reset value="清除">
　　<input type=button name=b1 value="↓高级选项↓" onclick="options.style.display=(options.style.display=='none')?'':'none'"></div>
<div id=options style="margin: 3; padding: 2; border: dotted 1 gray; display: none" align=right>
<input type=checkbox name=CheckBox3> 仅Unicode转ANSI
　<input type=checkbox name=CheckBox1> 使用颜色： <select name="color" size="1">
<option value="royalblue" style="color:royalblue;" selected>royalblue</option>
<option value="Black" style="color:black;">Black</option>
<option value="Red" style="color:red;">Red</option>
<option value="Yellow" style="color:yellow">Yellow</option>
<option value="Pink" style="color:pink">Pink</option>
<option value="Green" style="color:green;">Green</option>
<option value="Orange" style="color:orange;">Orange</option>
<option value="Purple" style="color:purple;">Purple</option>
<option value="Blue" style="color:blue;">Blue</option>
<option value="Beige" style="color:beige">Beige</option>
<option value="Brown" style="color:brown;">Brown</option>
<option value="Teal" style="color:teal;">Teal</option>
<option value="Navy" style="color:navy;">Navy</option>
<option value="Maroon" style="color:maroon;">Maroon</option>
<option value="LimeGreen" style="color:limegreen;">LimeGreen</option></select>
　<input type=checkbox name=CheckBox2> 去除空行</div>
<div><TEXTAREA name=Hrefs rows=15 cols=300></TEXTAREA><BR>
Discuz! 3.1.2 URL 代码：<BR>
<TEXTAREA name=VBBURLs rows=15 cols=300></TEXTAREA></div></td></tr></FORM></table>
<p>作者：Tele 2002-4-16　修改：zhangshaox for <a href="http://www.edonkey2000.cn">edonkey2000.cn</a> 2004-12-15</p>
</center></BODY>
</HTML>
